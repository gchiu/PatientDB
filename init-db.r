Rebol []

dbase: open odbc://patients
port: first dbase

; we are not going to use the NHI as the id but a unique integer
; NHI format is 3 alpha 4 integer

; attempt [insert port {drop table nhilookup}]
insert port ['tables "NHILOOKUP"] ;'
if none? pick port 1 [
    insert port {create table nhilookup ( id integer generated by default as identity primary key, "NHI" CHAR(7) UNIQUE NOT NULL)}
    ; dummy data
    ;insert port {insert into nhilookup (nhi) values ('MZK1240')}
    ;insert port {insert into nhilookup (nhi) values ('abc1234')}
    ;insert port {insert into nhilookup (nhi) values ('efg1923')}

]

;insert port {select * from NHILOOKUP}

;foreach nhis copy port [probe nhis]

; create the clinicians database
; id int surname var 128 fname varchar 128 clintype (1 = doc, 2 = cns) registration int

insert port ['tables "CLINICIANS"] ;'

if none? pick port 1 [
    insert port {create table clinicians ( id integer generated by default as identity primary key, 
        surname varchar(128),
        fname varchar(128),
        clintype int,
        registration int  
    )}
    ; real rheumatology data
    insert port {insert into clinicians ( surname, fname, clintype) values ('Chiu', 'Graham', 1)}
    insert port {insert into clinicians ( surname, fname, clintype) values ('Elasir', 'Haitham', 1)}
    insert port {insert into clinicians ( surname, fname, clintype) values ('Porten', 'Lauren', 2)}
    insert port {insert into clinicians ( surname, fname, clintype) values ('Sawyers', 'Stephen', 1)}
]

; add consults
; id int, clinician id, date timestamp, text blob_e, checksum 

insert port ['tables "letters"] ;'
if none? pick port 1 [
    insert port {
        create table letters (
            id integer generated by default as identity primary key,
            clinicians integer,
            cdate date,
            dictation blob sub_type text,
            checksum char(43)
        )
    }
]

close port
